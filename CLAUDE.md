# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Repository Purpose

**Documentation-only project**. This repository contains technical specifications and user stories for features that will be implemented in the target project. No implementation work happens here - only documentation generation.

## CRITICAL: Agent Output Display Instructions

### IMPORTANT: Display Full Agent Output
When using agents via the Task tool, Claude Code MUST:
1. **Display the agent's complete formatted output** - Show the entire response as generated by the agent
2. **Preserve all markdown formatting** - Keep headings, bold text, lists, code blocks exactly as formatted
3. **Do NOT summarize or reformat** - Present the agent's output verbatim, not a condensed version
4. **Add minimal commentary** - Only add brief context before/after if necessary

Example of CORRECT behavior:
- Agent generates formatted Phase 1 output with headings and lists
- Claude displays the ENTIRE formatted output to user
- User sees the complete formatted response with all details

Example of INCORRECT behavior:
- Agent generates formatted output
- Claude summarizes it into plain bullet points
- User loses the formatting and detail the agent provided

### Why This Matters
- Agents are configured to produce specific formatted outputs (especially story-doc-generator Phase 1)
- The formatting contains important structure and visual hierarchy
- Users need to see the complete agent response to make informed decisions
- Summarizing loses the agent's intended presentation and detail


## Documentation Structure

```
/
├── .claude/
│   ├── templates/                    # Documentation templates
│   │   ├── project-brief.template.md      # Project context template (SETUP)
│   │   ├── system-patterns.template.md    # Architecture patterns template (SETUP)
│   │   ├── tech-context.template.md       # Tech constraints template (SETUP)
│   │   ├── active-tech-doc.template.md    # Tech doc work tracking
│   │   ├── active-story-doc.template.md   # Story generation work tracking
│   │   ├── tech-doc.template.md           # Tech doc output format
│   │   ├── user-story.template.md         # Story output format
│   │   ├── research.template.md
│   │   ├── component-pattern.template.md
│   │   ├── doc-practice.template.md
│   │   └── design-decision.template.md
│   └── archive-config.json           # Archive configuration
├── .memory-bank/                     # Knowledge management system
│   ├── active-tech-doc.md            # Current tech doc work tracking
│   ├── active-story-doc.md           # Current story generation tracking
│   ├── project-brief.md              # Target project context and requirements
│   ├── system-patterns.md            # Component architecture patterns
│   ├── tech-context.md               # Tech stack & design system
│   ├── archive-index.md              # Main knowledge navigation hub
│   └── docs/
│       ├── completed-docs/           # Component-centric documentation output
│       │   └── {Component}/          # Each component's complete documentation
│       │       ├── YYYY-MM-DD-{category}-{Component}.md  # Tech doc
│       │       ├── stories/          # User stories subfolder
│       │       │   └── YYYY-MM-DD-{##}_{topic}.md        # Individual stories
│       │       ├── active-tech-doc.md    # Archived work context
│       │       └── active-story-doc.md   # Archived work context
│       ├── research-sessions/        # Design & UX analysis
│       ├── component-patterns/       # Reusable component patterns
│       ├── documentation-practices/  # Quality & process patterns
│       └── design-decisions/         # Design & architecture decisions
```

## Documentation Generation with Claude Code Agents

### Agent-Based Documentation System

This repository now uses specialized Claude Code sub-agents for automated documentation generation. Each agent is designed to work autonomously while following project-specific templates and configurations.

### Memory Bank System

This repository integrates a **knowledge management system** (memory bank) that preserves documentation insights, tracks work in progress, and enables pattern reuse across components.

**Key Benefits**:
- **Active work tracking**: Know what documentation is in progress (active-tech-doc.md, active-story-doc.md)
- **Knowledge archival**: Never lose documentation insights or patterns
- **Pattern discovery**: Find similar past components instantly via indexes
- **Automated indexing**: 6 indexes auto-update via hooks after each agent completes
- **Cross-referencing**: Link related documentation sets automatically
- **Session tracking**: Log agent activity, session duration, components completed

**Core Files**:
- `project-brief.md` - Target project context and requirements
- `system-patterns.md` - Component architecture patterns by type
- `tech-context.md` - Tech stack, design system, constraints
- `active-tech-doc.md` - Current technical documentation work
- `active-story-doc.md` - Current user story generation work
- `archive-index.md` - Main knowledge navigation hub (auto-generated)

**Index Files** (auto-generated by hooks):
- `archive-index.md` - Statistics, recent activity, navigation hub
- `docs/completed-docs-index.md` - Component documentation index
- `docs/research-sessions-index.md` - Research findings index
- `docs/component-patterns-index.md` - Patterns index
- `docs/documentation-practices-index.md` - Practices index
- `docs/design-decisions-index.md` - Decisions index

### Memory Bank Setup (First-Time Initialization)

**Before using agents, you must initialize the memory bank core files.** Agents depend on these files for project context.

#### Step 1: Create Core Memory Bank Files

Copy templates from `.claude/templates/` to `.memory-bank/` and fill with project-specific information:

**1. project-brief.md** - Project context and requirements
```bash
cp .claude/templates/project-brief.template.md .memory-bank/project-brief.md
# Then edit .memory-bank/project-brief.md with your project information
```

**What to include:**
- Project name and purpose
- Target audience
- Technology stack (framework, UI library, state management, etc.)
- Component architecture approach
- Platform constraints (desktop/mobile/responsive strategy)
- Accessibility requirements
- Timeline and team structure

**2. system-patterns.md** - Component architecture patterns
```bash
cp .claude/templates/system-patterns.template.md .memory-bank/system-patterns.md
# Then edit .memory-bank/system-patterns.md with your architecture
```

**What to include:**
- Component classification system (atom/molecule/organism/widget)
- Common patterns by category (grids, forms, navigation, modals)
- Design token structure
- API integration patterns
- State management approach

**Note**: This file starts simple and grows as components are documented. Initial setup only needs classification system and framework details.

**3. tech-context.md** - Technical constraints and design system
```bash
cp .claude/templates/tech-context.template.md .memory-bank/tech-context.md
# Then edit .memory-bank/tech-context.md with your tech details
```

**What to include:**
- Design system details (library, version, theming approach)
- Design token categories and access patterns
- Implementation constraints (file structure, naming conventions)
- State management rules
- Accessibility standards
- Platform-specific constraints (responsive breakpoints, browser support)

#### Step 2: Verify Memory Bank Structure

Ensure all required directories exist:
```bash
mkdir -p .memory-bank/docs/completed-docs
mkdir -p .memory-bank/docs/research-sessions
mkdir -p .memory-bank/docs/component-patterns
mkdir -p .memory-bank/docs/documentation-practices
mkdir -p .memory-bank/docs/design-decisions
```

#### Step 3: Initialize Active Work Files

Active work files will be auto-created by agents, but you can pre-create them from templates:
```bash
cp .claude/templates/active-tech-doc.template.md .memory-bank/active-tech-doc.md
cp .claude/templates/active-story-doc.template.md .memory-bank/active-story-doc.md
```

#### Step 4: Validate Setup

**Checklist - Verify all files exist:**
- [ ] `.memory-bank/project-brief.md` exists and contains project information
- [ ] `.memory-bank/system-patterns.md` exists and contains architecture details
- [ ] `.memory-bank/tech-context.md` exists and contains tech stack details
- [ ] `.memory-bank/docs/` directory structure created
- [ ] `.memory-bank/active-tech-doc.md` exists (or will be auto-created)
- [ ] `.memory-bank/active-story-doc.md` exists (or will be auto-created)

**Test agents can load context:**
Try running research-agent or tech-doc-generator - they should successfully load memory bank files without errors.

#### Template Reference

All memory bank templates include detailed instructions and placeholders:
- `.claude/templates/project-brief.template.md` - Comprehensive project context template
- `.claude/templates/system-patterns.template.md` - Architecture patterns template
- `.claude/templates/tech-context.template.md` - Technical constraints template

### Available Agents

#### 1. Research Agent (`research-agent`)
**Purpose**: Comprehensive design & UX research using Figma API, Context7, web sources, and knowledge base.

**Usage**:
```bash
> Use research-agent to analyze Header component design with Figma URL https://figma.com/...
```

**Key Features**:
- Figma design analysis with token mapping
- UX behavior extraction and reconciliation
- Context7 library documentation integration
- Knowledge base search for similar components
- Web best practices research
- Saves findings to research-sessions/ with complete evidence

#### 2. Tech Doc Generator (`tech-doc-generator`)
**Purpose**: Generates comprehensive technical documentation with memory bank integration.

**Usage**:
```bash
# With Figma (design-first approach)
> Use tech-doc-generator to document Header with Figma URL https://figma.com/...

# From existing code (implementation-first approach)
> Use tech-doc-generator to document Menu Bar from existing code

# With multiple sources (comprehensive approach)
> Use tech-doc-generator to document LoginForm with Figma URL https://figma.com/... and existing code
```

**Key Features**:
- Loads memory bank context (project-brief, system-patterns, tech-context)
- Searches for similar past components
- Follows template structure
- Auto-classifies components (atom/molecule/organism/widget)
- **Flexible source extraction**: Works with Figma, code, UX behaviors, or any combination
- Maps design tokens automatically
- Tracks work in active-tech-doc.md

#### 3. Story Doc Generator (`story-doc-generator`)
**Purpose**: Transforms technical documentation into implementable user stories with memory bank integration.

**Usage**:
```bash
> Use story-doc-generator to create stories for Header component
```

**Key Features**:
- Interactive two-phase workflow (topics approval → detailed stories)
- Loads memory bank context and documentation practices
- Searches for similar component story patterns
- GIVEN/WHEN/THEN acceptance criteria format
- 1-1.5 developer days per story max
- Tracks work in active-story-doc.md

#### 4. Doc Archival Agent (`doc-archival-agent`)
**Purpose**: Specialized archival with pattern and practice extraction.

**Usage**:
```bash
> Use doc-archival-agent to archive and extract patterns from Header work
```

**Key Features**:
- Archives complete documentation sets
- Identifies and extracts reusable component patterns
- Documents effective documentation practices
- Maintains cross-references between related work
- Enables future component acceleration


### Legacy Manual Process (Fallback)

If agents are not available, refer to agent markdown files in `.claude/agents/` for detailed manual procedures. The agent-based workflow is strongly recommended over manual processes.

## Key Documentation Principles

### For All Tasks
- **Documentation only** - Never write implementation code
- **Follow templates strictly** - Consistency is critical
- **Reconcile sources** - Figma (visual) + UX (functional) + Existing project code
- **Use design tokens** - Never hard-code values
- **ALWAYS align with existing project infrastructure** - Avoid duplication, leverage existing components

### Source Hierarchy
- **Figma** = source of truth for visuals
- **UX behaviors** = source of truth for interactions
- **Project codebase** = source of truth for implementation patterns
- **Conflicts** → Figma wins for visual, project codebase wins for implementation

### Language Requirements
- **Technical docs** → precise, exhaustive
- **User stories** → non-technical, user-centric
- **Acceptance criteria** → GIVEN/WHEN/THEN format

### Quality Checks
- **Completeness** - All requirements documented
- **No overlap** - Each story has unique scope
- **Token usage** - No hard-coded values
- **Time estimates** - 1-2 days per story max
- **Project alignment** - Leverages existing infrastructure
- **No testing stories** - Storybook integrated into relevant stories
- **Responsive approach** - Define target platforms and breakpoints in project-brief.md

## Reference Documents

### Setup Templates (for initialization)
- `.claude/templates/project-brief.template.md` - Project context template
- `.claude/templates/system-patterns.template.md` - Architecture patterns template
- `.claude/templates/tech-context.template.md` - Technical constraints template

### Output Templates (define generated documentation format)
- `.claude/templates/tech-doc.template.md` - technical specification
- `.claude/templates/user-story.template.md` - User story with GIVEN/WHEN/THEN ACs
- `.claude/templates/research.template.md` - Research session findings
- `.claude/templates/component-pattern.template.md` - Reusable component pattern
- `.claude/templates/doc-practice.template.md` - Documentation practice
- `.claude/templates/design-decision.template.md` - Design/architecture decision

### Tracking Templates (monitor work progress)
- `.claude/templates/active-tech-doc.template.md` - Technical documentation work tracking
- `.claude/templates/active-story-doc.template.md` - Story generation work tracking

### Configuration
- `.claude/archive-config.json` - Archive configuration for memory bank
- `.memory-bank/` - Knowledge management system with active work tracking

## Workflow Summary

### Unified Documentation Pipeline (Recommended)

**Complete workflow with memory bank integration:**

```
1. [Optional] Research Phase
   > Use research-agent to analyze [component] with Figma URL
   ↓
   - Saves findings to .memory-bank/docs/research-sessions/
   - Analyzes Figma design, UX behaviors, similar components
   - Provides design token mappings and component classification

2. Technical Documentation
   > Use tech-doc-generator to document [component] with [sources]
   Sources: Figma URL, existing code, UX behaviors, or combination
   ↓
   - Loads memory bank context (project-brief, patterns, tech-context)
   - Searches for similar past components
   - Extracts from all available sources
   - Tracks work in active-tech-doc.md
   - Saves tech doc to .memory-bank/docs/completed-docs/{Component}/

3. User Story Generation
   > Use story-doc-generator to create stories for [component]
   ↓
   - Phase 1: Proposes story topics for approval
   - Phase 2: Creates detailed stories after approval
   - Tracks work in active-story-doc.md
   - Saves stories to .memory-bank/docs/completed-docs/{Component}/stories/

4. Archive & Extract Knowledge
   > Use doc-archival-agent to archive [component] work
   ↓
   - Archives active-tech-doc.md + active-story-doc.md to component folder
   - All documentation in .memory-bank/docs/completed-docs/{Component}/ (tech doc, stories, active files)
   - Extracts component patterns to component-patterns/
   - Extracts documentation practices to documentation-practices/
   - Creates fresh active files for next component
   - Hooks update all 5 knowledge indexes automatically
```

**Accelerated workflow (with existing patterns):**
```
Research (optional) → Tech Doc → Stories → Archive
    ↓                    ↓          ↓         ↓
  Saved to         Saved to   Saved to   Patterns
  research/        completed-docs/ completed-docs/  Extracted
                   {Component}/    {Component}/stories/
```

### Manual Workflow (Fallback)

If agents are unavailable, use manual process:

```
1. Extract UX Behavior → /ux_behaviors/ (legacy)
   ↓
2. Generate Tech Doc → .memory-bank/docs/completed-docs/{Component}/
   (reconciles Figma + UX)
   ↓
3. Generate User Stories → .memory-bank/docs/completed-docs/{Component}/stories/
   (breaks down tech doc)
```

## Important Notes

### For Unified Documentation Pipeline

**Memory Bank Integration:**
- **Active work tracking** - All work tracked in active-tech-doc.md and active-story-doc.md
- **Knowledge discovery** - Agents search memory bank for similar past work
- **Pattern reuse** - Apply component patterns from previous documentation
- **Practice application** - Follow proven documentation practices automatically
- **Automated archival** - Doc-archival-agent archives active files to component folder

**Agent Usage:**
- **Use agents via Task tool** - Invoke through Claude Code's Task tool
- **Flexible sources** - Provide available sources (Figma URL, existing code, UX behaviors, or combination)
- **Agent will ask** - If sources unclear, agent asks: "What sources should I use?"
- **Sequential workflow** - Research → Tech Doc → Stories → Archive
- **Quality assurance** - Agents enforce strict quality standards automatically

**Knowledge Management:**
- **Automatic indexing** - Hooks update all 6 indexes after every agent completion (no manual intervention)
- **Archive regularly** - Archive completed work to build knowledge base
- **Extract patterns** - Identify reusable patterns from each component
- **Document practices** - Capture effective approaches for future use

**Hook System:**
- **SessionStart** - Logs session start, creates session ID for tracking
- **SubagentStop** - Triggers index updates + agent activity logging after any agent completes
- **UserPromptSubmit** - Warns if active work detected (active-tech-doc.md or active-story-doc.md in progress)
- **SessionEnd** - Logs session summary with duration, component count, and git branch

**Index Files** (auto-generated):
- **archive-index.md** - Main knowledge navigation hub with statistics and recent activity
- **completed-docs-index.md** - Component documentation with recent additions
- **research-sessions-index.md** - Design & UX research findings
- **component-patterns-index.md** - Reusable extracted patterns
- **documentation-practices-index.md** - Proven story sizing and AC practices
- **design-decisions-index.md** - Architectural and technical decisions

### For Manual Workflow (Fallback)
- **Ask for missing information** - Don't proceed without required inputs
- **UX behavior file recommended** before tech doc generation
- **Tech doc required** before user stories
- **Create folders** as needed for organization
- **Use Context7 MCP** for library documentation when needed

### Getting Started

**First-Time Setup:**
1. **Initialize memory bank** - See "Memory Bank Setup" section above for detailed instructions
   - Copy and fill templates: project-brief.md, system-patterns.md, tech-context.md
   - Create directory structure
   - Validate all files exist and contain project information
2. **Review agent files** in `.claude/agents/` for capabilities
3. **Check templates** in `.claude/templates/` for structure
4. **Test workflow** with one component to validate setup
   - Try research-agent or tech-doc-generator
   - Verify agents can load memory bank context without errors

**For Each Component:**
1. **Optional: Research first** - Use research-agent for complex/unfamiliar components
2. **Generate tech doc** - Use tech-doc-generator with available sources:
   - Provide Figma URL if available
   - Specify "from existing code" if no Figma
   - Use combination for comprehensive documentation
   - Agent will ask if sources are unclear
3. **Generate stories** - Use story-doc-generator after tech doc complete
4. **Archive work** - Use doc-archival-agent
5. **Apply patterns** - Reuse patterns from similar components

**Knowledge Base Growth:**
- First component: Baseline documentation, no patterns yet
- 2-3 components: Patterns start emerging, reference past work
- 4+ components: Rich knowledge base, accelerated documentation
- Ongoing: Continuous improvement through practice extraction